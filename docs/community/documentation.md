# Chapter 18. Documentation

[TOC]

Unix の最初の用途は 1971 年、文書作成のプラットフォームとしてであった。Bell Labs
が出願用の特許文書を作成するために使用した。1973 年に Joe Ossana の troff(1)
が誕生してから何年もの間、その技術状況を明確にさせてきた。

それ以来、文書整形、組版、ページレイアウトプログラムは Unix の伝統の中で重要な主
題となってきた。Unix の開発者と道具は今日、WWW の出現によって引き起こされた、文
書作成の実践における広範囲にわたる変化の最先端にある。

## Documentation Concepts

"What You See Is What You Get" (WYSIWYG) 文書作成プログラムとマークアップ中心の
ツールの違いを検討する。

WYSIWYG:

* GUI を有する。
* 入力内容は、最終的な印刷版に近くなるように描かれた、画面上の文書表示に直接挿入
  される。

マークアップ中心：

* 文書は制御タグを含む平坦なテキスト。
* マークアップされたソースは普通のテキストエディターで編集可能。
* 印刷や画面用描画のためには、整形プログラムが必要。

WYSIWYG 方式は初期の計算機ハードウェアには高価過ぎたため、1984 年に Macintosh PC
が登場するまでまれな存在だった。一方、Unix 生え抜きの文書ツールはほとんどすべて
マークアップ中心だ。1971 年の Unix の troff(1) はマークアップ整形プログラムで、
おそらく今でも使われている最古のものだろう。

WYSIWYG の実際の実装はさまざまな点で壊れがちであるため、マークアップ中心のツール
にはまだ役割がある。

WYSIWYG 文書処理ツールには GUI に関する一般的な問題 ([Chapter 11]) がある。何で
も視覚的に操作できるということは、何でも視覚的に操作しなければならないということ
になりがちだ。

WYSIWYG 文書プロセッサーは正確には WYSIWIG ではない。 ほとんどのインターフェイス
は画面表示と印刷出力の違いを、実際にはなくすことなく曖昧にしている。つまり、イン
ターフェイスの視覚的な側面によって、タイプライターではないにもかかわらず、タイプ
ライターのようにプログラムを使うように促され、入力が予期せぬ望ましくない結果を生
み出すことがある。

WYSIWIG システムは実際にはマークアップコードに依存しているが、通常の使用ではそれ
を見えないようにするために多大な努力をしている。つまり、マークアップのすべてを見
ることができないので、マークアップコードの見当違いで壊れた文書を修正するのが難し
いのだ。

WYSIWYG 文書プロセッサーは 300 ページの原稿のレイアウトを全体的に変更する必要が
ある場合、窮屈になりがちだ。

> WYSIWYG users faced with that kind of challenge must give it up or suffer the
> death of a thousand mouse clicks;

このような状況ではマークアップを編集できることに代わるものはない。

今日、文書の体裁と構造的マークアップを区別することが一般的になっている。前者は、
文書がどのように見えるべきかについての指示であり、後者は、文書がどのように構成さ
れ、何を意味するかについての指示だ。

体裁準位のマークアップは文書自体のすべての整形情報が伝わる。構造マークアップシス
テムでは、文書はスタイルシートと組み合わされなければならない。スタイルシートは、
ドキュメントの構造マークアップを物理的なレイアウトにどのように変換するかを指示す
るものだ。

> Macros are user-defined commands that are expanded by text substitution into
> sequences of built-in markup requests.

マークアップ中心の文書システムのほとんどはマクロ機能を支援している。通常、これら
のマクロはマークアップ言語に構造的な機能（節の見出しを宣言する機能など）を追加す
る。

Mike Lesk: マクロセットは整形偏向の編集から内容重視の編集へと人々を押しやるため
に設計したものだ。どのマクロも、一つの文書を作成し、その体裁を統制することに集中
していた人々に負けた。Web ページが読者と著者のどちらが体裁を統制すべきかという論
争で泥沼にはまるのとちょうど同じだ。私は `.AU` (author) コマンドを斜体を得るため
だけに使っている秘書をよく見かけた。

!!! note

    負けてしまったが、昔の HTML 編集技法を思い出させる証言だ。

小さな文書（手紙や小冊子など）でやりたいことと、大きな文書（書籍や技術論文など）
でやりたいことには大きな違いがあることに注意したい。大規模な文書は、より多くの構
造を持ち、別々に変更しなければならない部分からつなぎ合わされ、目次のような自動的
に生成される機能を必要とする傾向がある。どちらの性質もマークアップ中心の道具が好
ましい。

## The Unix Style

Unix 式の文書作成（およびその道具）には、技術的、文化的な特徴がいくつかあり、他
の場所でのそれとは異なっている。これらの特徴を理解することで、次を理解するための
文脈を作れ：

* なぜプログラムや実践がそのように見えるのか
* なぜ文書がそのように読めるのか

### The Large-Document Bias

Unix 文書作成道具は大規模で複雑な文書を作成する想定で設計されてきた。その結果、
Unix 開発者はマークアップ中心の道具を愛するようになった。当時の PC 使用者とは異
なり、Unix 文化は WYSIWYG 道具に感心しなかった。

中身の見えない、特に専売バイナリー形式に対する嫌悪感も WYSIWYG 道具の拒絶に一役
買った。

Unix のプログラマーたちはその言語文書が利用可能になるとすぐに PostScript を熱狂
的に利用した。最近のオープンソースの Unix システムには優れた PostScript と
Portable Document Format (PDF) 道具がある。

Unix の文書作成道具は、画像を含めるための援助が比較的弱く、図や表、グラフ、数学
的な組版、つまり技術論文でしばしば必要とされる種類のものを強力に支持する傾向があ
る。

Unix の比較的原始的な CLI スタイルが多くの点で GUI よりも有能使用者の必要に適し
ているように、troff(1) のような道具のマークアップ中心の設計は WYSIWYG プログラム
よりも有能執筆者の必要に適している。

WWW の発展により、1993 年頃から、文書を複数のメディアで（少なくとも印刷物と HTML
の両方で）表示する能力が中心的な課題となった。同時に、HTML の影響を受けて、一般
人もマークアップ中心のシステムを使いこなすようになった。これは、1996 年以降の構
造的マークアップへの関心の爆発と XML の発明に直接つながった。

2003 年半ばの今日、構造的マークアップを使用する XML ベースの文書道具の最先端の開
発のほとんどは Unix の下で行われている。しかし同時に、Unix 文化は体裁準位のマー
クアップシステムという古い伝統を手放していない。HTML と XML は `troff` を部分的
にしか駆逐していない。

### Cultural Style

ほとんどのソフトウェア文書は知識のある人が知識のない人のために書いている。Unixシ
ステムに同梱される文書は伝統的にプログラマーが仲間のために書いてきた。同業者間の
文書でない場合でも、Unix システムに同梱されている膨大な量のプログラマー間の文書
から、スタイルやフォーマットにおいて影響を受ける傾向がある。

Unix のマニュアルページには伝統的に BUGS という節がある。Unix の文化では仲間同士
がソフトウェアの既知の欠点を詳細に説明し合うので、使用者は短いながらも有益な
BUGS 節を質の高い作業の励みになると考える。

BUGS 節を抑えたりするような商用 Unix 頒布は必ず衰退していく。

一流の Unix 文書は電信的でありながら完全であるように書かれている。この流儀は自信
があるがっついた読者を想定している。

Unix プログラマーは参照文を書くのが得意な傾向があり、ほとんどの Unix 文書は、そ
れを書く人と同じように考えているけれども、まだそのソフトウェアの専門家ではない人
に助言を述べるような趣がある。その結果、実際よりもずっと不可解で疎かに見えること
がよくある。

> Read every word carefully, because whatever you want to know will probably be
> there, or deducible from what's there. Read every word carefully, because you
> will seldom be told anything twice.

## The Zoo of Unix Documentation Formats

最新のものを除くすべての主要な Unix 文書形式はマクロパッケージによって支援される
体裁準位のマークアップだ。以下、それらを古いものから新しいものへと見ていく。

### `troff` and the Documenter's Workbench Tools

[Chapter 8] も見ろ。

`troff` は体裁準位のマークアップ言語を解釈する。GNU groff(1) のような最近の実装
では、既定で PostScript を出力する。

!!! note

    Example 18.1 の内容などは、テキストファイルに保存して次のコマンドで PDF に変換できる：

    ```console
    groff example.txt > example.ps
    ps2pdf example.ps
    ```

素の `troff` で書かれた文書はほとんどない。`troff` はマクロ機能を支援しており、
半ダースのマクロパッケージが多かれ少なかれ一般的に用いられる。これらのうち、圧倒
的に一般的なのは、Unix のマニュアルページを書くために使用される man(7) マクロパッ
ケージだ。

nroff(1) と呼ばれる troff(1) のより重要でない亜種は行印刷装置やキャラクターセル
端末のような、定幅字体しか支持できない機器用の出力を生成する。端末ウィンドウで
Unix のマニュアルページを表示する場合、それを描くのは `nroff` だ。

Documenter's Workbench の道具群は、そのために設計された技術文書作成の仕事をよく
こなし、計算機の能力が千倍にもなったにもかかわらず、三十年以上も使い続けられてき
たのだ。

しかし、いくつかの点でひどく落ち込んでいる。最も深刻な問題はマークアップの多くが
体裁準位であるため、修正されていない `troff` ソースから良い Web ページを作るのが
難しいということだ。

### TeX

TeX は Emacs エディターと同様、Unix 文化の外で生まれたが、今では Unix 文化に帰化
している有能な組版プログラムだ。著名な計算機科学者である Donald Knuth が 1970 年
代後半に、特に数学の組版の質の低さに焦りを感じたときに作ったものだ。

* troff(1) と同様、マークアップ中心。
* 言語は `troff` よりも強力で、特に画像やページ位置の正確な内容、国際化などの処
  理に優れている。
* 特に数学的な組版が得意で、文字詰め、行間詰め、分綴といった基本的な組版作業では
  群を抜いている。
* ほとんどの数学専門誌の標準投稿形式となっている。
* American Mathematical Society の作業集団によってオープンソースとして管理されて
  いる。
* 科学論文にもよく用いられる。

troff(1) と同様、人間は通常、生の TeX マクロを手で大量に書くことはしない。ある特
定のマクロパッケージである LaTeX はほとんど普遍的であり、TeX で編集していると言
う人のほとんどは、実際には LaTeX を書いているという意味であることがほとんどだ。

TeX の重要な用途の一つは、通常使用者には見えないが、次のような他の文書処理ツール
では、PostScript を生成するよりも LaTeX を生成して PostScript に変換することが多
い：

* xmlto(1)
* XML DocBook

TeX は troff(1) よりも応用範囲が広く、ほとんどの点でより優れた設計だ。

TeX は Web 中心の世界において `troff` と同じ根本的な問題を抱えている。マークアッ
プは体裁準位で強い結びつきがあり、TeX ソースから優れた Web ページを自動的に生成
することは難しく、欠陥が生じやすい。

TeX が Unix システム文書に使われることはないし、アプリケーション文書に使われるこ
ともまれだ。

### Texinfo

Texinfo は Free Software Foundation が考案した文書マークアップで、主に GNU プロ
ジェクトの文書に用いられている。Emacs や GCC などの重要な道具の文書もそうだ。

Texinfoは、紙への組版出力と閲覧用のハイパーテキスト出力の両方を支持するように特
別に設計された最初のマークアップシステムだ。ただし、ハイパーテキストの形態は
HTML ではなく info と呼ばれるもっと原始的なもので、もともとは Emacs の中から閲覧
できるように設計されていた。印刷側では、Texinfo は TeX マクロに変換され、そこか
らPostScript に変換することができる。

2003 年半ば現在、Free Software Foundation は試行錯誤的な Texinfo から DocBook へ
の翻訳に取り組んでいる。

### POD

Plain Old Documentation は Perl の保守者が使用しているマークアップシステムだ。こ
れはマニュアルページを生成し、体裁準位の～。

### HTML

Unix プロジェクトでは少ないながらも HTML で直接文書を書く割合が増えてきた。この
方法論の問題は HTML から高品質の組版出力を生成するのが難しいことだ。索引を生成す
るのに必要な情報が HTML には存在しないのだ。

### DocBook

DocBook は大規模で複雑な技術文書用に設計された SGML と XML の文書型定義だ。純粋
に構造的であるという点で、Unix 共同体で使われているマークアップ形式の中では唯一
のものだ。

[Chapter 14] で述べた xmlto(1) は、HTML, XHTML, PostScript, PDF, Windows Help
マークアップ、等々の形態への変換を支援している。

主要なオープンソースプロジェクトのいくつかはすでに主形式として DocBook を使って
いる。本書は XML-DocBook で書いた。

## The Present Chaos and a Possible Way Out

## DocBook

### Document Type Definitions

### Other DTDs

### The DocBook Toolchain

### Migration Tools

### Editing Tools

### Related Standards and Practices

### SGML

### XML-DocBook References

## Best Practices for Writing Unix Documentation

[Chapter 8]: <../design/minilanguages.md>
[Chapter 11]: <../design/interface.md>
[Chapter 14]: <../implementation/languages.md>
