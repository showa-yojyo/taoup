# Chapter 20. Futures

[TOC]

未来を forcast するのは難しいが、二つの方法で anticipate することはできる：

* Unix が過去にどのように設計上の課題に対処してきたかを見る。
* 解決策を探している問題や活用待ちの機運を特定する。

## Essence and Accident in Unix Tradition

目標は Unix の設計が将来どのように変化するかを理解することだ。そのために Unix の
プログラミング流儀が過去にどのように変化してきたかを見ることから始める。

* 目標：偶然と本質の区別する。言い換えると、一過性の技術的状況から生じる特徴と、
  Unix の中心的な設計課題と深く結びついている特徴を認識する。
* Unix の中心的な設計課題：システムの透明性と単純性を維持しながら、モジュール化
  と抽象化をいかに正しくやるか。

偶発的に生まれた特質が本質的な有用性を持つことが後で判明することもあるから、この
区別は難しい可能性がある。例：[Chapter 11] で検討した「沈黙は金なり」法則。

その一方で、かつて不可欠と思われた特性のいくつかは、特定の費用比率に結びついた事
故であることが判明した。例えば、

* 古の Unix は入力を一行ずつ、一レコードずつ処理する設計を好んだ。
* 新派の Unix 設計は全入力をメモリーに読み込んで、その後はランダムアクセスできる
  という前提で、一般的に満足している。

この変更は、より単純で透明性の高いコードを得るために、ストレージの経済性を手放す
ということだ。プログラマーの時間に対するメモリーの費用が急落していることへの適応
だ。

Unix の設計様式を大きく変化させたな技術の変化を特定することができた：

* Internetworking
* Bitmapped graphics displays
* The personal computer

いずれの場合も、Unix の伝統はもはや適応できない偶然の出来事を捨て去り、その本質
的な思いつきの新しい適用を見つけることで難題に適応してきた。

復習：

* [Chapter 2]: TCP/IP が Unix と ARPANET の二つの文化を結合した。
* [Chapter 7]: System V の STREAMS のような、時代遅れのプロセス間通信やネット
  ワーキングの手法に関する資料が示唆するように、Unix の開発者たちが初手から誤
  り、歩みを誤り、十年間行き詰まった。

やがて TCP/IP が勝利し、BSD ソケットが「すべてがバイトストリーム」という主張を再
び示すようになると混乱は解消した。1990-1991 年の WWW の発明はその帰結だ。

TCP/IP の数年後、1984 年にビットマップグラフィックスと Macintosh の例が登場した
とき、さらなる難題が突きつけられた。Unix プログラマーの対応はポリシーとメカニズ
ムの分離を明確な原則とすることだった。X Window System は 1988 年までに確立された。

X のウィンドウ部品集合を低水準のグラフィックスを扱うディスプレイマネジャーから切
り離すことで、彼らは Unix 的にモジュール化されたきれいな建築方式を作り上げた。

難しいのは、Unix が統一インターフェイスポリシーを持つべきかどうか、持つとしたら
どうあるべきかを決めることだった。Motif のような市販ツールキットを通じて統一イン
ターフェースを確立しようとした試みがいくつあり、それらは失敗した。2003 年の今
日、GTK と Qt がその役割を争っている。

新しい流派の Unix 設計は、コマンドラインを維持し、両方の方式で使用できる CLI エ
ンジンと GUI のペアをたくさん書くことで、GUI と CLI の着手方法の間の緊張に対処し
てきた。

PC はそれ自体の技術としては設計上の大きな課題はほとんどなかった。真の挑戦は、
Unix の潜在的な市場の変化だった。ハードウェアの全体的な価格が大幅に下がったこと
で、PC は、技術的に洗練されていない、より幅広い使用者層にとって魅力的なものに
なった。

末端使用者向けデスクトップへの最初の本格的な取り組みはオープンソース共同体から生
まれた。2003 年半ば現在、市場調査によると Linux の市場占有率は約 4, 5% に達した。
Apple 社の Macintosh とほぼ同等だ。

テーマ化された GUI とインストールパッケージの下では、依然としてモジュール性とき
れいなコード、つまり本格的で高信頼性の演算と通信の基盤を正しく構築することに重点
が置かれている。

Mozilla や OpenOffice.org のようなデスクトップに焦点を当てた大規模な開発の歴史は
この強調をよく物語っている。どちらの事例においても、共同体からのフィードバックで
最も重要な主題は怪物的一枚岩に対する嫌悪感であり、これらの巨大なプログラムが厄介
な存在になる前に、減量し、内部構造を整頓し、モジュールに切り分けなければならない
という一般的な感覚であった。

!!! note

    OpenOffice.org は解散済み。

この三技術は基本的な Unix の設計法則、つまりモジュール性、透明性、ポリシーとメカ
ニズムの分離、そして本書の前半で特徴づけようとしたその他の品質に関しては保守的な
ものだった。

三十年以上にわたって強化されてきた Unix プログラマーの学習された反応は、最初の原
則に戻ることだった。つまり、新しいものを重ねることよりも、ストリーム、名前空間、
プロセスといった Unix の基本的な抽象化からより多くの力を引き出そうとすることだっ
た。

## Plan 9: The Way the Future Was

Unix を構築した Bell Labs の研究グループが設計した Plan 9 from Bell Labs は
かつての Unix の未来とはどのようなものであるかを体現したものだった。Plan 9 は
Unix をより良くやり直す試みだった。

* Plan 9 という名称は 1958 年の映画 *Plan 9 from Outer Space* へのオマージュだ。

Plan 9 設計者が試みた中心的な設計課題は：

> integrating graphics and ubiquitous networking into a comfortable Unix-like
> framework

だった。

* 単一の大きなファイル階層名前空間を通じてシステムサービスへのアクセスを仲介する。
* 装置ファイルに類似した特別ファイルに対する読み書きで多くの機能にアクセスする。
* 装置ファイルのほとんどはテキストファイル。
* システムサービスのほとんどはファイルサーバー。
* 資源はすべてファイルとして表現する。異なるサーバー上の資源へのアクセス問題
  を異なるサーバー上のファイルへのアクセス問題に転換する。

Plan 9 では Unix ファイルモデルを超えた Unix ファイルモデルと、私有名前空間とい
う新しい概念を組み合わせた。

使用者（実際にはプロセス）はすべて、ファイルサーバーのマウントの独自の木を作成す
ることによって、システムのサービスの独自のビューを持つことができる。ファイルサー
バーのマウントは使用者が手動で設定したものもあれば、ログイン時に自動的に設定され
たものもある。そのため、

> Plan 9 from Bell Labs 調査資料：
> `/dev/cons` はあなたの端末装置を、`/bin/date` は実行する `date` コマンドの正し
> いバージョンを常に指すが、これらのファイル名がどのファイルを表すかは、`date`を
> 実行する計算機の建築方式などの状況に依存する。

Plan 9 の単一で最も重要な特徴は、マウントされたファイルサーバーはすべて、その背
後にある実装に関係なく、同じファイルシステムのようなインターフェイスをエクスポー
トするということだ。

* あるものは局地ファイルシステムに対応し、
* あるものはネットワーク経由でアクセスされる遠隔ファイルシステムに対応し、
* あるものは使用者空間で実行されるシステムサーバーの実物に対応し、
* あるものはカーネルインターフェイスに対応する

ことがある。使用者やクライアントプログラムにとってはすべて同じように見える。

Plan 9 の調査報告書にある例の一つは遠隔サイトへの FTP アクセスの実装方法だ。
Plan 9 では ftp(1) コマンドがない。その代わりに ftpfs ファイルサーバーがある。各
FTP 接続はファイルシステムのマウントのように見える。

Plan 9 には

* Unix のシステムコールインターフェイスの問題点の再発明
* スーパーユーザーの廃止
* その他多くの興味深い再考

など、推薦できる点がたくさんある。設計は上品で、Unix の設計におけるいくつかの重
大な誤りを露呈している。なぜ世界を征服しなかったのか。

歴史の長い目で見れば話は違ってくるかもしれないが、2003 年の時点では、Plan 9 が失
敗したのは、単に Unix の先祖を置き換えるほどの説得力のある改良には至らなかったか
らだと思われる。Unix はガタが来ているものの、その地位を維持するのに十分な仕事を
こなしている。

> There is a lesson here for ambitious system architects: the most dangerous
> enemy of a better solution is an existing codebase that is just good enough.

Plan 9 の作意のいくつかは現代の Unix, とりわけ革新的なオープンソースのバージョン
に吸収されている：

* FreeBSD には、Plan 9 を正確にモデル化した `proc` ファイルシステムがあり、 実行
  中のプロセスの問い合わせや制御に使うことができる。
* FreeBSD の rfork(2) と Linux の clone(2) システムコールは Plan 9 の rfork(2)
  を手本にしている。
* Linux の `/proc` ファイルシステムはプロセス情報の提示に加えて、主にテキストイ
  ンターフェイスを使用してカーネル内部を照会し制御するために使用される、さまざま
  な人工 Plan 9 風装置ファイルを保持している。
* Linux の実験的な 2003 年版はプロセスごとのマウントポイントを実装している。
  Plan 9 の私有名前空間への大きな一歩だ。
* オープンソースの Unix はすべて、Plan 9 のために実際に発明された UTF-8 をシステ
  ム全体で支持する方向に進んでいる。

Unix の建築術のさまざまな部分が老衰に向かうにつれて、Plan 9 の多くが Unix に導入
されることになるかもしれない。

## Problems in the Design of Unix

### A Unix File Is Just a Big Bag of Bytes

### Unix Support for GUIs Is Weak

### File Deletion Is Forever

### Unix Assumes a Static File System

### The Design of Job Control Was Badly Botched

### The Unix API Doesn't Use Exceptions

### ioctl2 and fcntl2 Are an Embarrassment

### The Unix Security Model May Be Too Primitive

### Unix Has Too Many Different Kinds of Names

### File Systems Might Be Considered Harmful

### Towards a Global Internet Address Space

## Problems in the Environment of Unix

## Problems in the Culture of Unix

## Reasons to Believe

[Chapter 2]: <../context/history.md>
[Chapter 7]: <../design/multiprogram.md>
[Chapter 11]: <../design/interface.md>
